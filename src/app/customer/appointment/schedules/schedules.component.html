<!-- Remove duplicate header since it's handled by parent component -->
<div class="schedules-container">
  <!-- Pull to Refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="refreshSchedules($event)">
    <ion-refresher-content
      pullingIcon="chevron-down-circle-outline"
      pullingText="Pull to refresh"
      refreshingSpinner="circles"
      refreshingText="Refreshing...">
    </ion-refresher-content>
  </ion-refresher>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="enhanced-loading">
    <div class="loading-content">
      <div class="loading-animation">
        <ion-spinner name="crescent" color="primary"></ion-spinner>
      </div>
      <h3>Loading Your Appointments</h3>
      <p>Please wait while we fetch your scheduled appointments...</p>
    </div>
  </div>

  <!-- Current Customer Info (Optional Display) -->
  <div *ngIf="!isLoading && currentCustomer" class="customer-info-section">
    <div class="customer-welcome">
      <h1>Welcome back, {{ getCustomerName() }}!</h1>
      <p>Here are your scheduled appointments</p>
    </div>
  </div>

  <!-- Today's Appointments Section -->
  <div *ngIf="!isLoading && todayAppointments.length > 0" class="appointments-section today-section">
    <div class="section-title">
      <div class="title-content">
        <div class="title-icon">
          <ion-icon name="sunny-outline"></ion-icon>
        </div>
        <div class="title-text">
          <h2>Today's Schedule</h2>
          <p>Your appointments for today</p>
        </div>
      </div>
      <div class="section-badge">
        {{ todayAppointments.length }} appointment{{ todayAppointments.length !== 1 ? 's' : '' }}
      </div>
    </div>
    
    <div class="appointments-grid">
      <div *ngFor="let appointment of todayAppointments; trackBy: trackByAppointmentId" 
           class="modern-appointment-card today-appointment">
        <div class="card-priority-bar" [attr.data-urgency]="getPriorityColor(appointment.datetime)"></div>
        
        <div class="card-header">
          <div class="service-badge">
            <ion-icon name="car-outline"></ion-icon>
            <span>{{ appointment.service_rate.service_type.serviceTypeName }}</span>
          </div>
          <div class="urgency-chip" [attr.data-urgency]="getPriorityColor(appointment.datetime)">
            <ion-icon name="time-outline"></ion-icon>
            <span>{{ getTimeUntil(appointment.datetime) }}</span>
          </div>
        </div>

        <div class="card-content">
          <div class="service-details">
            <h3>{{ appointment.service_rate.service_type.serviceTypeName }}</h3>
            <p>{{ appointment.service_rate.service_type.serviceTypeDescription }}</p>
          </div>

          <div class="appointment-info">
            <div class="info-row">
              <div class="info-item">
                <ion-icon name="time-outline" color="primary"></ion-icon>
                <div class="info-content">
                  <span class="info-label">Time</span>
                  <span class="info-value">{{ formatTime(appointment.datetime) }}</span>
                </div>
              </div>
              
              <div class="info-item">
                <ion-icon name="car-sport-outline" color="secondary"></ion-icon>
                <div class="info-content">
                  <span class="info-label">Vehicle Size</span>
                  <span class="info-value">{{ appointment.service_rate.vehicle_size.vehicleSizeDescription }}</span>
                </div>
              </div>
            </div>
            
            <div class="info-row">
              <div class="info-item">
                <ion-icon name="card-outline" color="success"></ion-icon>
                <div class="info-content">
                  <span class="info-label">Price</span>
                  <span class="info-value price-highlight">{{ formatPrice(appointment.service_rate.price) }}</span>
                </div>
              </div>
              
              <div class="info-item">
                <ion-icon [name]="getStatusIcon(appointment.status)" [color]="getStatusColor(appointment.status)"></ion-icon>
                <div class="info-content">
                  <span class="info-label">Status</span>
                  <ion-badge [color]="getStatusColor(appointment.status)" class="modern-badge">
                    {{ appointment.status | titlecase }}
                  </ion-badge>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Upcoming Appointments Section -->
  <div *ngIf="!isLoading && upcomingAppointments.length > todayAppointments.length" class="appointments-section upcoming-section">
    <div class="section-title">
      <div class="title-content">
        <div class="title-icon">
          <ion-icon name="calendar-outline"></ion-icon>
        </div>
        <div class="title-text">
          <h2>Upcoming Appointments</h2>
          <p>Your scheduled appointments</p>
        </div>
      </div>
      <div class="section-badge">
        {{ upcomingAppointments.length - todayAppointments.length }} upcoming
      </div>
    </div>
    
    <div class="appointments-grid">
      <div *ngFor="let appointment of upcomingAppointments.slice(todayAppointments.length); trackBy: trackByAppointmentId" 
           class="modern-appointment-card upcoming-appointment">
        <div class="card-priority-bar upcoming-bar"></div>
        
        <div class="card-header">
          <div class="service-badge upcoming-service">
            <ion-icon name="car-outline"></ion-icon>
            <span>{{ appointment.service_rate.service_type.serviceTypeName }}</span>
          </div>
          <div class="date-time-chip">
            <div class="chip-date">{{ formatDate(appointment.datetime) }}</div>
            <div class="chip-time">{{ formatTime(appointment.datetime) }}</div>
          </div>
        </div>

        <div class="card-content">
          <div class="service-details">
            <h3>{{ appointment.service_rate.service_type.serviceTypeName }}</h3>
            <p>{{ appointment.service_rate.service_type.serviceTypeDescription }}</p>
          </div>

          <div class="appointment-info">
            <div class="info-row">
              <div class="info-item">
                <ion-icon name="car-sport-outline" color="secondary"></ion-icon>
                <div class="info-content">
                  <span class="info-label">Vehicle Size</span>
                  <span class="info-value">{{ appointment.service_rate.vehicle_size.vehicleSizeDescription }}</span>
                </div>
              </div>
              
              <div class="info-item">
                <ion-icon name="card-outline" color="success"></ion-icon>
                <div class="info-content">
                  <span class="info-label">Price</span>
                  <span class="info-value price-highlight">{{ formatPrice(appointment.service_rate.price) }}</span>
                </div>
              </div>
            </div>
            
            <div class="info-row">
              <div class="info-item status-full">
                <ion-icon [name]="getStatusIcon(appointment.status)" [color]="getStatusColor(appointment.status)"></ion-icon>
                <div class="info-content">
                  <span class="info-label">Status</span>
                  <ion-badge [color]="getStatusColor(appointment.status)" class="modern-badge">
                    {{ appointment.status | titlecase }}
                  </ion-badge>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced Empty State -->
  <div *ngIf="!isLoading && upcomingAppointments.length === 0" class="enhanced-empty-state">
    <div class="empty-illustration">
      <div class="empty-circle">
        <ion-icon name="calendar-clear-outline"></ion-icon>
      </div>
    </div>
    <div class="empty-content">
      <h2>No Confirmed Appointments</h2>
      <p>You don't have any confirmed appointments scheduled at the moment.</p>
      <div class="empty-suggestions">
        <p>Here's what you can do:</p>
        <ul>
          <li>Check if you have any pending bookings waiting for confirmation</li>
          <li>Book a new car wash service</li>
          <li>Contact us if you have any questions</li>
        </ul>
      </div>
      <ion-button fill="solid" color="primary" class="cta-button" routerLink="/booking">
        <ion-icon name="add-circle-outline" slot="start"></ion-icon>
        Book New Service
      </ion-button>
    </div>
  </div>

  <!-- Login Required State (when no customer ID found) -->
  <div *ngIf="!isLoading && !isLoggedIn()" class="enhanced-empty-state">
    <div class="empty-illustration">
      <div class="empty-circle">
        <ion-icon name="person-outline"></ion-icon>
      </div>
    </div>
    <div class="empty-content">
      <h2>Login Required</h2>
      <p>Please log in to view your appointments and schedule new services.</p>
      <ion-button fill="solid" color="primary" class="cta-button" routerLink="/login">
        <ion-icon name="log-in-outline" slot="start"></ion-icon>
        Login to Continue
      </ion-button>
    </div>
  </div>
</div>